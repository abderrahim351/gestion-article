<div class="min-h-screen flex flex-col bg-gray-100">
  <!-- HEADER -->
  <header class="w-full bg-gray-800 text-white">
    <div class="max-w-5xl mx-auto flex items-center justify-between px-4 py-3">
      <a routerLink="/articles" class="text-lg font-semibold">
        Blog Collaboratif
      </a>

      <nav class="flex items-center gap-4 text-sm">
        <!-- Lien articles -->
        <a routerLink="/articles" routerLinkActive="underline">
          Articles
        </a>

       
        <div *ngIf="auth.isLoggedIn()" class="relative">
          <button
            (click)="toggleNotifications()"
            class="relative flex items-center justify-center w-8 h-8 rounded-full bg-gray-700 hover:bg-gray-600 text-lg"
          >
            <span>ðŸ””</span>
            <span
              *ngIf="unreadCount"
              class="absolute -top-1 -right-1 bg-red-500 text-[10px] leading-none text-white rounded-full px-1 py-[2px]"
            >
              {{ unreadCount }}
            </span>
          </button>

        
          <div
            *ngIf="showNotifications"
            class="absolute right-0 mt-2 w-80 bg-white text-gray-800 rounded shadow-lg text-xs z-20"
          >
            <div
              class="px-3 py-2 border-b font-semibold text-gray-700 flex justify-between items-center"
            >
              <span>Notifications (24h)</span>
              <span class="text-[10px] text-gray-400">
                {{ unreadCount }} non lues
              </span>
            </div>

            <ng-container *ngIf="notifications.length; else noNotif">
              <button
                *ngFor="let n of notifications"
                (click)="openNotification(n)"
                class="w-full text-left px-3 py-2 border-b last:border-b-0 hover:bg-gray-100"
                [ngClass]="{
                  'bg-gray-50 font-normal': n.read,
                  'bg-white font-semibold': !n.read
                }"
              >
                <div class="flex justify-between items-center">
                  <div class="text-gray-800">
                    {{ n.articleTitle }}
                  </div>
                  <div class="text-[10px] text-gray-400">
                    {{ n.createdAt }}
                  </div>
                </div>
                <div class="text-[11px] text-gray-600 mt-1">
                  "{{ n.content | slice: 0: 80
                  }}{{ n.content.length > 80 ? '...' : '' }}"
                </div>
              </button>
            </ng-container>

            <ng-template #noNotif>
              <div class="px-3 py-3 text-[11px] text-gray-500">
                Aucune notification sur les derniÃ¨res 24 heures.
              </div>
            </ng-template>
          </div>
        </div>

        <ng-container *ngIf="auth.isLoggedIn(); else loggedOut">
          <div #userMenuWrapper class="relative">
            <button
              (click)="toggleUserMenu()"
              class="flex items-center gap-2 bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs text-white"
            >
              ðŸ‘¤ {{ auth.getCurrentUser()?.name }}
            </button>

            <div
              *ngIf="showUserMenu"
              class="absolute right-0 mt-2 w-44 bg-white text-gray-800 rounded shadow-lg text-sm z-30 border"
            >
              <div class="px-4 py-2 border-b text-xs text-gray-500">
                <div class="font-semibold text-gray-800">
                  {{ auth.getCurrentUser()?.name }}
                </div>
                <div class="text-[11px] text-gray-500">
                  {{ auth.getCurrentUser()?.email }}
                </div>
                <div class="text-[10px] text-gray-400 uppercase mt-1">
                  {{ auth.getCurrentUser()?.role }}
                </div>
              </div>

              <a
                routerLink="/profile"
                (click)="closeUserMenu()"
                class="block px-4 py-2 hover:bg-gray-100"
              >
                Profil
              </a>

              <a
                *ngIf="auth.getCurrentUser()?.role === 'ADMIN'"
                routerLink="/admin/users"
                (click)="closeUserMenu()"
                class="block px-4 py-2 hover:bg-gray-100 text-yellow-600"
              >
                Admin
              </a>

              <button
                (click)="logout()"
                class="block w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600"
              >
                Logout
              </button>
            </div>
          </div>
        </ng-container>

        <ng-template #loggedOut>
          <a
            routerLink="/login"
            class="px-3 py-1 rounded bg-blue-600 hover:bg-blue-500 text-white text-xs"
          >
            Login
          </a>
          <a
            routerLink="/register"
            class="px-3 py-1 rounded border border-blue-400 text-blue-400 hover:bg-blue-50 text-xs"
          >
            Register
          </a>
        </ng-template>
      </nav>
    </div>
  </header>

  <main class="flex-1">
    <div class="max-w-5xl mx-auto px-4 py-6">
      <router-outlet></router-outlet>
    </div>
  </main>

  <app-ui-notification></app-ui-notification>
  <app-confirm-dialog></app-confirm-dialog>
</div>
